function init(){camera=new THREE.PerspectiveCamera(75,SCREEN_WIDTH/SCREEN_HEIGHT,1,1e4),camera.position.z=450,scene=new THREE.Scene,birds=[],boids=[];for(var i=0;100>i;i++)boid=boids[i]=new Boid,boid.position.x=400*Math.random()-200,boid.position.y=400*Math.random()-200,boid.position.z=400*Math.random()-200,boid.velocity.x=2*Math.random()-1,boid.velocity.y=2*Math.random()-1,boid.velocity.z=2*Math.random()-1,boid.setAvoidWalls(!0),boid.setWorldSize(500,500,400),bird=birds[i]=new THREE.Mesh(new Bird,new THREE.MeshBasicMaterial({color:16777215*Math.random(),side:THREE.DoubleSide})),bird.phase=Math.floor(62.83*Math.random()),scene.add(bird);renderer=new THREE.CanvasRenderer({alpha:!0}),renderer.setClearColor(16777215,0),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(SCREEN_WIDTH,SCREEN_HEIGHT),document.addEventListener("mousemove",onDocumentMouseMove,!1),document.getElementById("canvas").appendChild(renderer.domElement),window.addEventListener("resize",onWindowResize,!1)}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function onDocumentMouseMove(i){for(var o=new THREE.Vector3(i.clientX-SCREEN_WIDTH_HALF,-i.clientY+SCREEN_HEIGHT_HALF,0),t=0,e=boids.length;e>t;t++)boid=boids[t],o.z=boid.position.z,boid.repulse(o)}function animate(){requestAnimationFrame(animate),render()}function render(){for(var i=0,o=birds.length;o>i;i++)boid=boids[i],boid.run(boids),bird=birds[i],bird.position.copy(boids[i].position),color=bird.material.color,color.r=color.g=color.b=(100-bird.position.z)/1e3,bird.rotation.y=Math.atan2(-boid.velocity.z,boid.velocity.x),bird.rotation.z=Math.asin(boid.velocity.y/boid.velocity.length()),bird.phase=(bird.phase+(Math.max(0,bird.rotation.z)+.1))%62.83,bird.geometry.vertices[5].y=bird.geometry.vertices[4].y=5*Math.sin(bird.phase);renderer.render(scene,camera)}var Boid=function(){var i,o,t=new THREE.Vector3,e=500,n=500,s=200,r=100,a=3.5,d=.1,c=!1;this.position=new THREE.Vector3,this.velocity=new THREE.Vector3,i=new THREE.Vector3,this.setGoal=function(i){o=i},this.setAvoidWalls=function(i){c=i},this.setWorldSize=function(i,o,t){e=i,n=o,s=t},this.run=function(o){c&&(t.set(-e,this.position.y,this.position.z),t=this.avoid(t),t.multiplyScalar(5),i.add(t),t.set(e,this.position.y,this.position.z),t=this.avoid(t),t.multiplyScalar(5),i.add(t),t.set(this.position.x,-n,this.position.z),t=this.avoid(t),t.multiplyScalar(5),i.add(t),t.set(this.position.x,n,this.position.z),t=this.avoid(t),t.multiplyScalar(5),i.add(t),t.set(this.position.x,this.position.y,-s),t=this.avoid(t),t.multiplyScalar(5),i.add(t),t.set(this.position.x,this.position.y,s),t=this.avoid(t),t.multiplyScalar(5),i.add(t)),Math.random()>.5&&this.flock(o),this.move()},this.flock=function(t){o&&i.add(this.reach(o,.005)),i.add(this.alignment(t)),i.add(this.cohesion(t)),i.add(this.separation(t))},this.move=function(){this.velocity.add(i);var o=this.velocity.length();o>a&&this.velocity.divideScalar(o/a),this.position.add(this.velocity),i.set(0,0,0)},this.checkBounds=function(){this.position.x>e&&(this.position.x=-e),this.position.x<-e&&(this.position.x=e),this.position.y>n&&(this.position.y=-n),this.position.y<-n&&(this.position.y=n),this.position.z>s&&(this.position.z=-s),this.position.z<-s&&(this.position.z=s)},this.avoid=function(i){var o=new THREE.Vector3;return o.copy(this.position),o.sub(i),o.multiplyScalar(1/this.position.distanceToSquared(i)),o},this.repulse=function(o){var t=this.position.distanceTo(o);if(150>t){var e=new THREE.Vector3;e.subVectors(this.position,o),e.multiplyScalar(.5/t),i.add(e)}},this.reach=function(i,o){var t=new THREE.Vector3;return t.subVectors(i,this.position),t.multiplyScalar(o),t},this.alignment=function(i){for(var o,t=new THREE.Vector3,e=0,n=0,s=i.length;s>n;n++)Math.random()>.6||(o=i[n],distance=o.position.distanceTo(this.position),distance>0&&distance<=r&&(t.add(o.velocity),e++));if(e>0){t.divideScalar(e);var a=t.length();a>d&&t.divideScalar(a/d)}return t},this.cohesion=function(i){for(var o,t,e=new THREE.Vector3,n=new THREE.Vector3,s=0,a=0,c=i.length;c>a;a++)Math.random()>.6||(o=i[a],t=o.position.distanceTo(this.position),t>0&&r>=t&&(e.add(o.position),s++));s>0&&e.divideScalar(s),n.subVectors(e,this.position);var h=n.length();return h>d&&n.divideScalar(h/d),n},this.separation=function(i){for(var o,t,e=new THREE.Vector3,n=new THREE.Vector3,s=0,a=i.length;a>s;s++)Math.random()>.6||(o=i[s],t=o.position.distanceTo(this.position),t>0&&r>=t&&(n.subVectors(this.position,o.position),n.normalize(),n.divideScalar(t),e.add(n)));return e}},SCREEN_WIDTH=window.innerWidth,SCREEN_HEIGHT=window.innerHeight,SCREEN_WIDTH_HALF=SCREEN_WIDTH/2,SCREEN_HEIGHT_HALF=SCREEN_HEIGHT/2,camera,scene,renderer,birds,bird,boid,boids,stats;init(),animate();